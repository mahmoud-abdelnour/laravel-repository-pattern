"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9526],{9526:(D,C,l)=>{l.r(C),l.d(C,{TasksModule:()=>K});var e=l(6895),o=l(9197),v=l(2252),y=l(8674),T=l(4763),_=l(1511),t=l(4650),Z=l(9807),f=l(7392),p=l(4859);function x(a,u){if(1&a){const n=t.EpF();t.TgZ(0,"button",1),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.parent.openDialog(s.FormMode.Update,s.rowData))}),t.TgZ(1,"mat-icon",2),t._uU(2,"edit"),t.qZA()()}}function I(a,u){if(1&a){const n=t.EpF();t.TgZ(0,"button",1),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.parent.popDelete(s.rowData))}),t.TgZ(1,"mat-icon",3),t._uU(2," delete "),t.qZA()()}}let E=(()=>{class a{constructor(){this.FormMode=T.h}ngOnInit(){}}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-actions"]],hostAttrs:[1,"list-actions-btns"],decls:2,vars:2,consts:[["mat-button","",3,"click",4,"appPerm"],["mat-button","",3,"click"],["color","primary"],["color","warn"]],template:function(n,i){1&n&&(t.YNc(0,x,3,0,"button",0),t.YNc(1,I,3,0,"button",0)),2&n&&(t.Q6J("appPerm","edit_task"),t.xp6(1),t.Q6J("appPerm","delete_task"))},dependencies:[Z.$,f.Hw,p.lW],styles:[".assign[_ngcontent-%COMP%]{color:#009688}"]}),a})();var A=l(5412),d=l(9242),g=l(3416),r=l(2278),h=l(8038),b=l(3546),c=l(4006),U=l(8746),F=l(1679),O=l(4115);function P(a,u){if(1&a){const n=t.EpF();t.TgZ(0,"div",20)(1,"h4"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"app-file-input",21),t.NdJ("deleteEvent",function(){const m=t.CHM(n).$implicit,k=t.oxw();return t.KtG(k.deleteAttachment(m))}),t.qZA()()}if(2&a){const n=u.$implicit,i=u.index;t.xp6(2),t.AsE(" ",i+1," - ",t.lcZ(3,3,"Attachment")," "),t.xp6(2),t.Q6J("control",n.value)}}function J(a,u){if(1&a&&(t.TgZ(0,"button",22),t._uU(1," \u062d\u0641\u0638 "),t.qZA()),2&a){const n=t.oxw();t.Q6J("disabled",n.isSaving)}}let L=(()=>{class a{constructor(n,i){this.apiService=n,this.themeService=i,this.deleted_attachments=[],this.counter=1,this.isSaving=!1}ngOnInit(){if(this.form=new c.cw({task_title:new c.NI(null,c.kI.required),task_period:new c.NI(null,[c.kI.required,c.kI.min(1)]),task_description:new c.NI(null),id:new c.NI(null)}),this.data&&this.form.patchValue(this.data),console.log(this.table),this.files=new c.cw({}),this.emp_files=new c.cw({}),this.data?.attachments)for(let i of this.data?.attachments)this.files.addControl("attachments_"+i.id,new c.NI({value:i.file_url,disabled:!1}))}deleteAttachment(n){this.files.removeControl(n.key),this.deleted_attachments.push(n.key)}addAttach(){this.counter++,this.files.addControl("attachmentss_"+this.counter,new c.NI(null))}add_task_attachments(n){let i={...this.form.value},s=new FormData;for(let m in i)null!==i[m]&&s.append(m,i[m]);s.append("entity_id",n),s.append("entity_type","employee"),s.append("deleted_attachments",this.deleted_attachments);for(let m in this.files.value)null!==this.files.value[m]&&"object"==typeof this.files.value[m]&&s.append(m,this.files.value[m],this.files.value.name)}save(){if(this.form.invalid)return;this.isSaving=!0;let n=this.form.getRawValue(),i=new FormData;for(let s in n)null!==n[s]&&i.append(s,n[s]);i.append("entity_id",this.data?.id),i.append("entity_type","employee"),i.append("deleted_attachments",this.deleted_attachments);for(let s in this.files.value)null!==this.files.value[s]&&"object"==typeof this.files.value[s]&&(console.log(this.files.value[s]),i.append(s,this.files.value[s],this.files.value.name));this.apiService.uploadFiles(this.data?_.A.provider.tasks+"/"+this.data.id:_.A.provider.tasks,i).pipe((0,U.x)(()=>this.isSaving=!1)).subscribe(s=>{this.themeService.openSnackBar("SavedSuccessfully",null),this.ref.close(!0),this.table.reloadTable()})}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(d.s),t.Y36(r.f))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-create"]],inputs:{ref:"ref",data:"data",mode:"mode",table:"table"},decls:34,vars:14,consts:[[3,"formGroup","ngSubmit"],["mat-dialog-title",""],[1,"mat-typography"],[1,"row"],[1,"col-md-12","form-group","mb-4"],["for","task_title"],["id","task_title","type","text","formControlName","task_title"],["for","task_period"],["id","task_period","type","number","formControlName","task_period"],[1,"col-md-12","form-group"],["for","task_description"],["name","task_description","formControlName","task_description"],[1,"col-md-12"],[1,"bold","mt-5"],[1,"mb-4","file-item"],["class","mb-4",4,"ngFor","ngForOf"],["mat-button","","color","success",1,"addAttachBtn","mr-2",3,"click"],["align","end",1,"actions"],["type","button","mat-button","","mat-dialog-close","",1,"cancel"],["mat-button","","cdkFocusInitial","","class","save",3,"disabled",4,"ngIf"],[1,"mb-4"],[3,"control","deleteEvent"],["mat-button","","cdkFocusInitial","",1,"save",3,"disabled"]],template:function(n,i){1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.save()}),t.TgZ(1,"h2",1),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"mat-dialog-content",2)(6,"div",3)(7,"div",4)(8,"label",5),t._uU(9," \u0627\u0633\u0645 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t._UZ(10,"input",6),t.qZA(),t.TgZ(11,"div",4)(12,"label",7),t._uU(13," \u0645\u062f\u0629 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.TgZ(14,"span"),t._uU(15,"(\u0628\u0627\u0644\u0633\u0627\u0639\u0627\u062a)"),t.qZA()(),t._UZ(16,"input",8),t.qZA(),t.TgZ(17,"div",9)(18,"label",10),t._uU(19," \u0648\u0635\u0641 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t._UZ(20,"textarea",11),t.qZA(),t.TgZ(21,"div",12)(22,"h4",13),t._uU(23,"\u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a"),t.qZA(),t.TgZ(24,"div",14),t.YNc(25,P,5,5,"div",15),t.ALo(26,"keyvalue"),t.qZA(),t.TgZ(27,"a",16),t.NdJ("click",function(){return i.addAttach()}),t._uU(28," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u0641\u0642 "),t.qZA()()()(),t.TgZ(29,"mat-dialog-actions",17)(30,"button",18),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.YNc(33,J,2,1,"button",19),t.qZA()()),2&n&&(t.Q6J("formGroup",i.form),t.xp6(2),t.AsE(" ",t.lcZ(3,6,i.mode)," ",t.lcZ(4,8,"Task")," "),t.xp6(23),t.Q6J("ngForOf",t.lcZ(26,10,i.files.controls)),t.xp6(6),t.hij(" ",t.lcZ(32,12,"Back")," "),t.xp6(2),t.Q6J("ngIf",!i.form.disabled))},dependencies:[e.sg,e.O5,F.Y,p.lW,p.zs,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.sg,c.u,A.ZT,A.uh,A.xY,A.H8,O.hL,O.J5,e.Nd,g.X$],styles:["label[for=task_period][_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px;color:#b6b918;font-style:italic}.addAttachBtn[_ngcontent-%COMP%]{background:#dfdfdf;margin-left:10px}.saveAttachBtn[_ngcontent-%COMP%]{background:rgb(90,148,90);color:#fff;margin-left:10px}h4.bold[_ngcontent-%COMP%]{font-weight:700}"]}),a})();const w=["dialog"],S=["table"];function N(a,u){if(1&a){const n=t.EpF();t.TgZ(0,"mat-card-header")(1,"div",5),t._UZ(2,"div"),t.TgZ(3,"button",6),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.openDialog())}),t.TgZ(4,"mat-icon"),t._uU(5,"add"),t.qZA(),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"translate"),t.qZA()()()}2&a&&(t.xp6(6),t.AsE(" ",t.lcZ(7,2,"Create")," ",t.lcZ(8,4,"Task")," "))}function B(a,u){if(1&a&&t._UZ(0,"app-create",7),2&a){const n=u.dialogRef,i=u.$implicit;t.oxw();const s=t.MAs(8);t.Q6J("ref",n)("data",i.data)("mode",i.mode)("table",s)}}const Y=[{path:"list",component:(()=>{class a{constructor(n,i,s,m,k){this.matDialog=n,this.apiService=i,this.translateService=s,this.datePipe=m,this.themeService=k,this.apiFunc=(M={})=>this.apiService.get(_.A.provider.tasks),this.settings={columns:{task_title:{title:"\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0645\u0647\u0645\u0629",type:v.Jm.Text,filter:!0},task_period:{title:"\u0645\u062f\u0629 \u0627\u0644\u0645\u0647\u0645\u0629",type:v.Jm.Text,filter:!0},created_at:{title:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0636\u0627\u0641\u0629",type:v.Jm.Text,valuePrepareFunction:(M,Q)=>this.datePipe.transform(M,"yyyy/MM/dd")},actions:{title:this.translateService.instant("Options"),type:v.Jm.Custom,renderComponent:E,sort:!1,filter:!1,onComponentInitFunction:M=>M.parent=this}}}}ngOnInit(){}openDialog(n=T.h.Create,i=null){this.matDialog.open(this.dialog,{data:{data:i,mode:n}}).afterClosed().subscribe(m=>{m&&this.table.reloadTable()})}popDelete(n){this.rowToDelete=n.id;let i=this.matDialog.open(y.F,{data:{parent:this}});i.componentInstance.header="DeleteTaskTitle",i.componentInstance.body="DeleteTaskMSG"}delete(){this.apiService.delete(_.A.provider.tasks+"/"+this.rowToDelete).subscribe(n=>{this.themeService.openSnackBar("DeleteSuccessMSG",null),this.table.reloadTable()})}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(A.uw),t.Y36(d.s),t.Y36(g.sK),t.Y36(e.uU),t.Y36(r.f))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-list"]],viewQuery:function(n,i){if(1&n&&(t.Gf(w,5),t.Gf(S,5)),2&n){let s;t.iGM(s=t.CRH())&&(i.dialog=s.first),t.iGM(s=t.CRH())&&(i.table=s.first)}},features:[t._Bn([e.uU])],decls:11,vars:6,consts:[[1,"card-cont"],[4,"appPerm"],[3,"settings","apiFunc"],["table",""],["dialog",""],[1,"d-flex","align-items-center","justify-content-between"],["mat-raised-button","",1,"add-btn",3,"click"],[3,"ref","data","mode","table"]],template:function(n,i){1&n&&(t.TgZ(0,"section",0)(1,"h2"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-card"),t.YNc(5,N,9,6,"mat-card-header",1),t.TgZ(6,"mat-card-content"),t._UZ(7,"app-table",2,3),t.qZA()()(),t.YNc(9,B,1,4,"ng-template",null,4,t.W1O)),2&n&&(t.xp6(2),t.hij(" ",t.lcZ(3,4,"Tasks")," "),t.xp6(3),t.Q6J("appPerm","create_task"),t.xp6(2),t.Q6J("settings",i.settings)("apiFunc",i.apiFunc))},dependencies:[h.a,Z.$,f.Hw,b.a8,b.dk,b.dn,p.lW,L,g.X$]}),a})()},{path:"",redirectTo:"list",pathMatch:"full"}];let R=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[o.Bz.forChild(Y),o.Bz]}),a})();var j=l(5754);let K=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[e.ez,R,j.m]}),a})()},8674:(D,C,l)=>{l.d(C,{F:()=>_});var e=l(5412),o=l(4650),v=l(3416),y=l(7392),T=l(4859);let _=(()=>{class t{constructor(f,p){this.translateService=f,this.data=p,this.header="DialogRemoveMessage",this.body="TableDeleteMessage",this.confirmBtn="Delete"}ngOnInit(){console.log(this.data),this.parent=this.data?.parent}}return t.\u0275fac=function(f){return new(f||t)(o.Y36(v.sK),o.Y36(e.WI))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-delete-dialog"]],decls:16,vars:13,consts:[["mat-dialog-title",""],["color","warn"],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close","","color","warn",3,"mat-dialog-close","click"],["mat-button","","mat-dialog-close","","cdkFocusInitial","","color","primary"]],template:function(f,p){1&f&&(o.TgZ(0,"h2",0)(1,"mat-icon",1),o._uU(2," warning "),o.qZA(),o.TgZ(3,"span"),o._uU(4),o.ALo(5,"translate"),o.qZA()(),o.TgZ(6,"div",2),o._uU(7),o.ALo(8,"translate"),o.qZA(),o.TgZ(9,"div",3)(10,"button",4),o.NdJ("click",function(){return null==p.parent?null:p.parent.delete()}),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"button",5),o._uU(14),o.ALo(15,"translate"),o.qZA()()),2&f&&(o.xp6(4),o.hij(" ",o.lcZ(5,5,p.header)," "),o.xp6(3),o.hij(" ",o.lcZ(8,7,p.body),"\n"),o.xp6(3),o.Q6J("mat-dialog-close",!0),o.xp6(1),o.hij(" ",o.lcZ(12,9,p.confirmBtn)," "),o.xp6(3),o.hij(" ",o.lcZ(15,11,"Back")," "))},dependencies:[y.Hw,T.lW,e.ZT,e.uh,e.xY,e.H8,v.X$],styles:["h2[_ngcontent-%COMP%]{display:flex;align-items:center}h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),t})()},1679:(D,C,l)=>{l.d(C,{Y:()=>A});var e=l(4650),o=l(4763),v=l(6895),y=l(7392),T=l(4859),_=l(4006),t=l(4115),Z=l(3416);const f=["control",""];function p(d,g){if(1&d&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&d){const r=e.oxw(2);e.xp6(1),e.hij(" ",r.fileSize," MB ")}}function x(d,g){if(1&d){const r=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(r);const b=e.oxw(2),c=e.MAs(3);return e.KtG(b.deleteFile(c))}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA()()}}function I(d,g){if(1&d&&(e.TgZ(0,"a",16)(1,"mat-icon"),e._uU(2,"download"),e.qZA()()),2&d){const r=e.oxw(2);e.Q6J("href",r.control.value,e.LSH)}}function E(d,g){if(1&d&&(e.TgZ(0,"div",8)(1,"span",9),e._uU(2),e.qZA(),e.YNc(3,p,2,1,"span",10),e.TgZ(4,"div",11),e.YNc(5,x,3,0,"button",12),e.YNc(6,I,3,1,"a",13),e.qZA()()),2&d){const r=e.oxw();e.xp6(2),e.hij(" ",(null==r.file?null:r.file.name)||r.fileName," "),e.xp6(1),e.Q6J("ngIf",r.file),e.xp6(2),e.Q6J("ngIf",!r.control.disabled),e.xp6(1),e.Q6J("ngIf",!r.file&&r.control.value)}}let A=(()=>{class d{constructor(){this.accept="image/*",this.deleteEvent=new e.vpe,this.FormMode=o.h}ngOnInit(){this.control.value&&"string"==typeof this.control.value&&(this.fileName=this.control.value.substr(this.control.value.lastIndexOf("/")+1))}fileChanged(r){this.file=r.target.files[0],this.fileSize=(this.file.size/1e6).toFixed(2),this.control.setValue(r.target.files[0]),this.control.markAsTouched()}deleteFile(r){this.file=null,r.type="",r.type="file",this.control.setValue(null),console.log(this.control),this.deleteEvent.emit(this.control)}}return d.\u0275fac=function(r){return new(r||d)},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-file-input","control",""]],inputs:{control:"control",accept:"accept"},outputs:{deleteEvent:"deleteEvent"},attrs:f,decls:11,vars:7,consts:[[1,"data"],[1,"input-cont","form-group"],["id","file","type","file","accept","image/*",3,"change"],["input",""],[1,"d-block"],["for","file"],["type","hidden","name","fileHidden",3,"formControl"],["class","file-info d-flex align-items-center justify-content-between",4,"ngIf"],[1,"file-info","d-flex","align-items-center","justify-content-between"],[1,"file-name"],["class","file-size",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","target","_blank","type","button","download","",3,"href",4,"ngIf"],[1,"file-size"],["mat-button","",3,"click"],["mat-button","","target","_blank","type","button","download","",3,"href"]],template:function(r,h){1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),e.NdJ("change",function(c){return h.fileChanged(c)}),e.qZA(),e.TgZ(4,"mat-icon",4),e._uU(5," cloud_upload "),e.qZA(),e.TgZ(6,"label",5),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.YNc(10,E,7,4,"div",7),e.qZA()),2&r&&(e.ekj("has-file",!!h.control.value||h.control.disabled),e.xp6(7),e.hij(" ",e.lcZ(8,5,"StartUploadingFile")," "),e.xp6(2),e.Q6J("formControl",h.control),e.xp6(1),e.Q6J("ngIf",h.file||h.control.value||h.control.disabled))},dependencies:[v.O5,y.Hw,T.lW,T.zs,_.Fj,_.JJ,_.oH,t.J5,Z.X$],styles:[".invalid-feedback[_ngcontent-%COMP%]{margin-top:-10px}[_nghost-%COMP%]     app-error{position:absolute;left:0;right:-7px;width:140px;bottom:-36px}.file-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;min-width:160px}.file-size[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem;min-width:160px}.file-info[_ngcontent-%COMP%]{flex-wrap:wrap}"]}),d})()},4763:(D,C,l)=>{l.d(C,{h:()=>e});var e=(()=>{return(o=e||(e={})).Create="Create",o.Update="Update",o.View="View",o.Delete="Delete",e;var o})()}}]);