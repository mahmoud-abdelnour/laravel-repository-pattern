"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3937],{3937:(x,A,l)=>{l.r(A),l.d(A,{TasksModule:()=>j});var e=l(6895),a=l(9197),Z=l(2252),h=l(1511),t=l(4650),T=l(7392),_=l(4859);let b=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-actions"]],hostAttrs:[1,"list-actions-btns"],decls:3,vars:0,consts:[["mat-button","",3,"click"],[1,"eye"]],template:function(n,o){1&n&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return o.parent.openDialog(o.rowData)}),t.TgZ(1,"mat-icon",1),t._uU(2,"visibility"),t.qZA()())},dependencies:[T.Hw,_.lW]}),i})();var f=l(8674),m=l(5412),y=l(9242),P=l(3416),k=l(2278),E=l(8038),r=l(3546),d=l(4006),u=l(8746),g=l(529),D=l(1679),M=l(4115);function U(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"div",16)(1,"app-file-input",17),t.NdJ("deleteEvent",function(){const p=t.CHM(n).$implicit,O=t.oxw();return t.KtG(O.deleteAttachment(p))}),t.qZA()()}if(2&i){const n=c.$implicit;t.xp6(1),t.Q6J("control",n.value)}}function I(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"div",16)(1,"app-file-input",17),t.NdJ("deleteEvent",function(){const p=t.CHM(n).$implicit,O=t.oxw();return t.KtG(O.deleteAttachment(p))}),t.qZA()()}if(2&i){const n=c.$implicit;t.xp6(1),t.Q6J("control",n.value)}}function F(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.process_task("start_task"))}),t._uU(1," \u0628\u062f\u0621 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA()}if(2&i){const n=t.oxw();t.Q6J("disabled",n.isSaving)}}function J(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.process_task("finish_task"))}),t._uU(1," \u0627\u0646\u0647\u0627\u0621 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA()}if(2&i){const n=t.oxw();t.Q6J("disabled",n.isSaving)}}let L=(()=>{class i{constructor(n,o,s){this.apiService=n,this.themeService=o,this.changeDetectorRef=s,this.deleted_attachments=[],this.counter=1}ngAfterViewChecked(){this.changeDetectorRef.detectChanges()}ngOnInit(){this.files=new d.cw({}),this.company_files=new d.cw({}),this.form=new d.cw({task_id:new d.NI(null),attachments:new d.NI(null)});for(let o of this.data?.emp_attachments)this.files.addControl("attachments_"+o.id,new d.NI({value:o.file_url,disabled:!1}));for(let o of this.data?.company_attachments)this.company_files.addControl("attachments_"+o.id,new d.NI({value:o.file_url,disabled:!0}))}deleteAttachment(n){this.files.removeControl(n.key),this.deleted_attachments.push(n.key)}addAttach(){this.counter++,this.files.addControl("attachmentss_"+this.counter,new d.NI(null))}add_task_attachments(n){let o={...this.form.value},s=new FormData;for(let p in o)null!==o[p]&&s.append(p,o[p]);s.append("entity_id",n),s.append("entity_type","employee"),s.append("deleted_attachments",this.deleted_attachments);for(let p in this.files.value)null!==this.files.value[p]&&"object"==typeof this.files.value[p]&&s.append(p,this.files.value[p],this.files.value.name);this.apiService.uploadFiles(h.A.provider.add_task_attachments,s).subscribe(p=>{p instanceof g.Zn&&(this.isSaving=!1,this.themeService.openSnackBar("\u062a\u0645 \u0627\u0644\u0625\u0636\u0627\u0641\u0629 \u0628\u0646\u062c\u0627\u062d"),this.ref.close(!0),this.table.reloadTable())},p=>this.isSaving=!1)}process_task(n=null){if(this.form.invalid)return;let o=null;"start_task"==n?o=h.A.employee.start_task:"finish_task"==n&&(o=h.A.employee.finish_task),this.isSaving=!0,this.apiService.post(o,{action:n,task_id:this.data.id}).pipe((0,u.x)(()=>this.isSaving=!1)).subscribe(s=>{this.ref.close(!0),this.table.reloadTable()})}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(y.s),t.Y36(k.f),t.Y36(t.sBO))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-create"]],hostAttrs:[1,"app-dialog"],inputs:{data:"data",ref:"ref",table:"table"},decls:58,vars:21,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"row"],[1,"col-md-4"],[1,"col-md-12"],[3,"formGroup"],[1,"bold","mt-2"],[1,"mb-4","file-item"],["class","mb-4",4,"ngFor","ngForOf"],["mat-button","","color","success",1,"addAttachBtn","mr-2",3,"click"],["mat-button","","color","success",1,"saveAttachBtn","mr-2",3,"click"],[1,"bold","mt-5"],["align","end",1,"actions"],["mat-button","","color","success","class","start_task",3,"disabled","click",4,"ngIf"],["mat-button","","color","success","class","finish_task",3,"disabled","click",4,"ngIf"],["mat-button","","mat-dialog-close","","cdkFocusInitial","",1,"cancel"],[1,"mb-4"],[3,"control","deleteEvent"],["mat-button","","color","success",1,"start_task",3,"disabled","click"],["mat-button","","color","success",1,"finish_task",3,"disabled","click"]],template:function(n,o){1&n&&(t.TgZ(0,"h2",0),t._uU(1," \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0647\u0645\u0629\n"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"div",3)(5,"h4"),t._uU(6," \u0627\u0633\u0645 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA()(),t.TgZ(9,"div",3)(10,"h4"),t._uU(11," \u0645\u062f\u0629 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()(),t.TgZ(14,"div",3)(15,"h4"),t._uU(16," \u0627\u0644\u0634\u0631\u0643\u0629 "),t.qZA(),t.TgZ(17,"p"),t._uU(18),t.qZA()(),t.TgZ(19,"div",3)(20,"h4"),t._uU(21," \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0633\u0646\u0627\u062f "),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.ALo(24,"date"),t.qZA()(),t.TgZ(25,"div",3)(26,"h4"),t._uU(27," \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0633\u062a\u062d\u0642\u0627\u0642 "),t.qZA(),t.TgZ(28,"p"),t._uU(29),t.ALo(30,"date"),t.qZA()(),t.TgZ(31,"div",4)(32,"h4"),t._uU(33," \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(34,"p"),t._uU(35),t.qZA()(),t.TgZ(36,"div",4)(37,"form",5)(38,"h4",6),t._uU(39,"\u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a"),t.qZA(),t.TgZ(40,"div",7),t.YNc(41,U,2,1,"div",8),t.ALo(42,"keyvalue"),t.qZA(),t.TgZ(43,"button",9),t.NdJ("click",function(){return o.addAttach()}),t._uU(44," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u0641\u0642 "),t.qZA(),t.TgZ(45,"button",10),t.NdJ("click",function(){return o.add_task_attachments(o.data.id)}),t._uU(46," \u062d\u0641\u0638 \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a "),t.qZA(),t.TgZ(47,"div",4)(48,"h4",11),t._uU(49,"\u0645\u0631\u0641\u0642\u0627\u062a \u0627\u0644\u0645\u0647\u0645\u0629"),t.qZA(),t.TgZ(50,"div",7),t.YNc(51,I,2,1,"div",8),t.ALo(52,"keyvalue"),t.qZA()()()()()(),t.TgZ(53,"mat-dialog-actions",12),t.YNc(54,F,2,1,"button",13),t.YNc(55,J,2,1,"button",14),t.TgZ(56,"button",15),t._uU(57," \u0625\u063a\u0644\u0627\u0642 "),t.qZA()()),2&n&&(t.xp6(8),t.hij(" ",o.data.task.task_title," "),t.xp6(5),t.hij(" ",o.data.task.task_period," "),t.xp6(5),t.hij(" ",o.data.company.name_ar," "),t.xp6(5),t.hij(" ",t.xi3(24,11,o.data.created_at,"yyyy/MM/dd hh:mm a")," "),t.xp6(6),t.hij(" ",t.xi3(30,14,o.data.due_date,"yyyy/MM/dd hh:mm a")," "),t.xp6(6),t.hij(" ",o.data.task.task_description," "),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("ngForOf",t.lcZ(42,17,o.files.controls)),t.xp6(10),t.Q6J("ngForOf",t.lcZ(52,19,o.company_files.controls)),t.xp6(3),t.Q6J("ngIf",null==o.data.started_at&&o.data.managable),t.xp6(1),t.Q6J("ngIf",null==o.data.finished_at&&null!=o.data.started_at&&o.data.managable))},dependencies:[e.sg,e.O5,D.Y,_.lW,d._Y,d.JL,d.sg,m.ZT,m.uh,m.xY,m.H8,M.hL,e.uU,e.Nd],styles:[".col-md-4[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]{margin-bottom:1rem}.col-md-4[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:18px;margin-bottom:10px}.col-md-4[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--main-color)}.start_task[_ngcontent-%COMP%]{background:rgb(148,230,148);color:#5a945a;border-color:#5a945a}.finish_task[_ngcontent-%COMP%]{background:rgb(226,174,105);color:#936427;border-color:#936427}.addAttachBtn[_ngcontent-%COMP%]{background:#dfdfdf;margin-left:10px}.saveAttachBtn[_ngcontent-%COMP%]{background:rgb(90,148,90);color:#fff;margin-left:10px}h4.bold[_ngcontent-%COMP%]{font-weight:700}"]}),i})();const w=["dialog"],S=["table"];function B(i,c){if(1&i&&t._UZ(0,"app-create",4),2&i){const n=c.dialogRef,o=c.$implicit;t.oxw();const s=t.MAs(6);t.Q6J("ref",n)("data",o.data)("table",s)}}const N=[{path:"list",component:(()=>{class i{constructor(n,o,s,p,O){this.matDialog=n,this.apiService=o,this.translateService=s,this.datePipe=p,this.themeService=O,this.apiFunc=(v={})=>this.apiService.get(h.A.employee.tasks,v),this.settings={columns:{task_title:{title:"\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0645\u0647\u0645\u0629",type:"string",filter:!0,valuePrepareFunction:(v,C)=>C.task.task_title},permissions:{title:"\u0645\u062f\u0629 \u0627\u0644\u0645\u0647\u0645\u0629",type:"string",valuePrepareFunction:(v,C)=>C.task.task_period+" \u0633\u0627\u0639\u0629"},date:{title:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0633\u0646\u0627\u062f",type:"string",valuePrepareFunction:(v,C)=>this.datePipe.transform(C.created_at,"yyyy/MM/dd h:mm a")},started_at:{title:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0628\u062f\u0621",type:"string",valuePrepareFunction:(v,C)=>this.datePipe.transform(C.started_at,"yyyy/MM/dd h:mm a")},finished_at:{title:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0646\u062a\u0647\u0627\u0621",type:"string",valuePrepareFunction:(v,C)=>this.datePipe.transform(C.finished_at,"yyyy/MM/dd h:mm a")},actions:{title:this.translateService.instant("Options"),type:Z.Jm.Custom,renderComponent:b,sort:!1,filter:!1,onComponentInitFunction:v=>{console.log(v),v.parent=this}}}}}ngOnInit(){}openDialog(n=null){this.matDialog.open(this.dialog,{data:{data:n}}).afterClosed().subscribe(s=>{console.log(`Dialog result: ${s}`)})}popDelete(n){this.rowToDelete=n.id;let o=this.matDialog.open(f.F,{data:{parent:this}});o.componentInstance.header="DeleteTaskTitle",o.componentInstance.body="DeleteTaskMSG"}delete(){this.apiService.delete(h.A.company.delete_task+"/"+this.rowToDelete).subscribe(n=>{this.themeService.openSnackBar("DeleteSuccessMSG",null)})}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(m.uw),t.Y36(y.s),t.Y36(P.sK),t.Y36(e.uU),t.Y36(k.f))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-list"]],viewQuery:function(n,o){if(1&n&&(t.Gf(w,5),t.Gf(S,5)),2&n){let s;t.iGM(s=t.CRH())&&(o.dialog=s.first),t.iGM(s=t.CRH())&&(o.table=s.first)}},features:[t._Bn([e.uU])],decls:9,vars:2,consts:[[1,"card-cont"],[3,"settings","apiFunc"],["table",""],["dialog",""],[3,"ref","data","table"]],template:function(n,o){1&n&&(t.TgZ(0,"section",0)(1,"h2"),t._uU(2," \u0627\u0644\u0645\u0647\u0627\u0645 "),t.qZA(),t.TgZ(3,"mat-card")(4,"mat-card-content"),t._UZ(5,"app-table",1,2),t.qZA()()(),t.YNc(7,B,1,3,"ng-template",null,3,t.W1O)),2&n&&(t.xp6(5),t.Q6J("settings",o.settings)("apiFunc",o.apiFunc))},dependencies:[E.a,r.a8,r.dn,L]}),i})()},{path:"",redirectTo:"list",pathMatch:"full"}];let R=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[a.Bz.forChild(N),a.Bz]}),i})();var Y=l(5754);let j=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[e.ez,R,Y.m]}),i})()},8674:(x,A,l)=>{l.d(A,{F:()=>T});var e=l(5412),a=l(4650),Z=l(3416),h=l(7392),t=l(4859);let T=(()=>{class _{constructor(f,m){this.translateService=f,this.data=m,this.header="DialogRemoveMessage",this.body="TableDeleteMessage",this.confirmBtn="Delete"}ngOnInit(){console.log(this.data),this.parent=this.data?.parent}}return _.\u0275fac=function(f){return new(f||_)(a.Y36(Z.sK),a.Y36(e.WI))},_.\u0275cmp=a.Xpm({type:_,selectors:[["app-delete-dialog"]],decls:16,vars:13,consts:[["mat-dialog-title",""],["color","warn"],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close","","color","warn",3,"mat-dialog-close","click"],["mat-button","","mat-dialog-close","","cdkFocusInitial","","color","primary"]],template:function(f,m){1&f&&(a.TgZ(0,"h2",0)(1,"mat-icon",1),a._uU(2," warning "),a.qZA(),a.TgZ(3,"span"),a._uU(4),a.ALo(5,"translate"),a.qZA()(),a.TgZ(6,"div",2),a._uU(7),a.ALo(8,"translate"),a.qZA(),a.TgZ(9,"div",3)(10,"button",4),a.NdJ("click",function(){return null==m.parent?null:m.parent.delete()}),a._uU(11),a.ALo(12,"translate"),a.qZA(),a.TgZ(13,"button",5),a._uU(14),a.ALo(15,"translate"),a.qZA()()),2&f&&(a.xp6(4),a.hij(" ",a.lcZ(5,5,m.header)," "),a.xp6(3),a.hij(" ",a.lcZ(8,7,m.body),"\n"),a.xp6(3),a.Q6J("mat-dialog-close",!0),a.xp6(1),a.hij(" ",a.lcZ(12,9,m.confirmBtn)," "),a.xp6(3),a.hij(" ",a.lcZ(15,11,"Back")," "))},dependencies:[h.Hw,t.lW,e.ZT,e.uh,e.xY,e.H8,Z.X$],styles:["h2[_ngcontent-%COMP%]{display:flex;align-items:center}h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),_})()},1679:(x,A,l)=>{l.d(A,{Y:()=>E});var e=l(4650),a=l(4763),Z=l(6895),h=l(7392),t=l(4859),T=l(4006),_=l(4115),b=l(3416);const f=["control",""];function m(r,d){if(1&r&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&r){const u=e.oxw(2);e.xp6(1),e.hij(" ",u.fileSize," MB ")}}function y(r,d){if(1&r){const u=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(u);const D=e.oxw(2),M=e.MAs(3);return e.KtG(D.deleteFile(M))}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA()()}}function P(r,d){if(1&r&&(e.TgZ(0,"a",16)(1,"mat-icon"),e._uU(2,"download"),e.qZA()()),2&r){const u=e.oxw(2);e.Q6J("href",u.control.value,e.LSH)}}function k(r,d){if(1&r&&(e.TgZ(0,"div",8)(1,"span",9),e._uU(2),e.qZA(),e.YNc(3,m,2,1,"span",10),e.TgZ(4,"div",11),e.YNc(5,y,3,0,"button",12),e.YNc(6,P,3,1,"a",13),e.qZA()()),2&r){const u=e.oxw();e.xp6(2),e.hij(" ",(null==u.file?null:u.file.name)||u.fileName," "),e.xp6(1),e.Q6J("ngIf",u.file),e.xp6(2),e.Q6J("ngIf",!u.control.disabled),e.xp6(1),e.Q6J("ngIf",!u.file&&u.control.value)}}let E=(()=>{class r{constructor(){this.accept="image/*",this.deleteEvent=new e.vpe,this.FormMode=a.h}ngOnInit(){this.control.value&&"string"==typeof this.control.value&&(this.fileName=this.control.value.substr(this.control.value.lastIndexOf("/")+1))}fileChanged(u){this.file=u.target.files[0],this.fileSize=(this.file.size/1e6).toFixed(2),this.control.setValue(u.target.files[0]),this.control.markAsTouched()}deleteFile(u){this.file=null,u.type="",u.type="file",this.control.setValue(null),console.log(this.control),this.deleteEvent.emit(this.control)}}return r.\u0275fac=function(u){return new(u||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-file-input","control",""]],inputs:{control:"control",accept:"accept"},outputs:{deleteEvent:"deleteEvent"},attrs:f,decls:11,vars:7,consts:[[1,"data"],[1,"input-cont","form-group"],["id","file","type","file","accept","image/*",3,"change"],["input",""],[1,"d-block"],["for","file"],["type","hidden","name","fileHidden",3,"formControl"],["class","file-info d-flex align-items-center justify-content-between",4,"ngIf"],[1,"file-info","d-flex","align-items-center","justify-content-between"],[1,"file-name"],["class","file-size",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","target","_blank","type","button","download","",3,"href",4,"ngIf"],[1,"file-size"],["mat-button","",3,"click"],["mat-button","","target","_blank","type","button","download","",3,"href"]],template:function(u,g){1&u&&(e.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),e.NdJ("change",function(M){return g.fileChanged(M)}),e.qZA(),e.TgZ(4,"mat-icon",4),e._uU(5," cloud_upload "),e.qZA(),e.TgZ(6,"label",5),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.YNc(10,k,7,4,"div",7),e.qZA()),2&u&&(e.ekj("has-file",!!g.control.value||g.control.disabled),e.xp6(7),e.hij(" ",e.lcZ(8,5,"StartUploadingFile")," "),e.xp6(2),e.Q6J("formControl",g.control),e.xp6(1),e.Q6J("ngIf",g.file||g.control.value||g.control.disabled))},dependencies:[Z.O5,h.Hw,t.lW,t.zs,T.Fj,T.JJ,T.oH,_.J5,b.X$],styles:[".invalid-feedback[_ngcontent-%COMP%]{margin-top:-10px}[_nghost-%COMP%]     app-error{position:absolute;left:0;right:-7px;width:140px;bottom:-36px}.file-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;min-width:160px}.file-size[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem;min-width:160px}.file-info[_ngcontent-%COMP%]{flex-wrap:wrap}"]}),r})()},4763:(x,A,l)=>{l.d(A,{h:()=>e});var e=(()=>{return(a=e||(e={})).Create="Create",a.Update="Update",a.View="View",a.Delete="Delete",e;var a})()}}]);