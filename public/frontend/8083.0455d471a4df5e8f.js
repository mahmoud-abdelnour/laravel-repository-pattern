"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8083],{5605:(P,g,o)=>{o.d(g,{L:()=>t});var e=o(6895),s=o(5754),T=o(3238),h=o(9602),m=o(4650);let t=(()=>{class r{}return r.\u0275fac=function(A){return new(A||r)},r.\u0275mod=m.oAB({type:r}),r.\u0275inj=m.cJS({imports:[e.ez,s.m,T.XK,h.FA]}),r})()},3523:(P,g,o)=>{o.d(g,{S:()=>w});var e=o(6895),s=o(4006),T=o(8746),h=o(4763),m=o(1511),t=o(4650),r=o(9242),C=o(2278),A=o(1679),O=o(4859),Z=o(8796),v=o(5412),D=o(4115),E=o(9602),c=o(3416);function f(a,d){if(1&a&&(t.TgZ(0,"ng-option",18),t._uU(1),t.qZA()),2&a){const n=d.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.name_ar," ")}}function _(a,d){if(1&a){const n=t.EpF();t.TgZ(0,"div",5)(1,"label"),t._uU(2," \u0627\u0644\u0645\u0648\u0638\u0641 "),t.qZA(),t.TgZ(3,"ng-select",17),t.NdJ("change",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.getTasks(l))}),t.YNc(4,f,2,2,"ng-option",7),t.qZA()()}if(2&a){const n=t.oxw();t.xp6(4),t.Q6J("ngForOf",n.employees)}}function p(a,d){if(1&a&&(t.TgZ(0,"ng-option",18),t._uU(1),t.qZA()),2&a){const n=d.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.task_title," ")}}function k(a,d){if(1&a){const n=t.EpF();t.TgZ(0,"div",29)(1,"app-file-input",30),t.NdJ("deleteEvent",function(){const u=t.CHM(n).$implicit,x=t.oxw(3);return t.KtG(x.deleteAttachment(u))}),t.qZA()()}if(2&a){const n=d.$implicit;t.xp6(1),t.Q6J("control",n.value)}}function M(a,d){if(1&a&&(t.TgZ(0,"div",22)(1,"h4",28),t._uU(2,"\u0645\u0631\u0641\u0642\u0627\u062a \u0627\u0644\u0645\u0647\u0645\u0629"),t.qZA(),t.TgZ(3,"div",25),t.YNc(4,k,2,1,"div",26),t.ALo(5,"keyvalue"),t.qZA()()),2&a){const n=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",t.lcZ(5,1,n.task_files.controls))}}function I(a,d){if(1&a){const n=t.EpF();t.TgZ(0,"div",29)(1,"app-file-input",30),t.NdJ("deleteEvent",function(){const u=t.CHM(n).$implicit,x=t.oxw(2);return t.KtG(x.deleteAttachment(u))}),t.qZA()()}if(2&a){const n=d.$implicit;t.xp6(1),t.Q6J("control",n.value)}}function y(a,d){if(1&a){const n=t.EpF();t.TgZ(0,"div",29)(1,"app-file-input",30),t.NdJ("deleteEvent",function(){const u=t.CHM(n).$implicit,x=t.oxw(3);return t.KtG(x.deleteAttachment(u))}),t.qZA()()}if(2&a){const n=d.$implicit;t.xp6(1),t.Q6J("control",n.value)}}function U(a,d){if(1&a&&(t.TgZ(0,"div",22)(1,"h4",28),t._uU(2,"\u0645\u0631\u0641\u0642\u0627\u062a \u0627\u0644\u0645\u0648\u0638\u0641"),t.qZA(),t.TgZ(3,"div",25),t.YNc(4,y,2,1,"div",26),t.ALo(5,"keyvalue"),t.qZA()()),2&a){const n=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",t.lcZ(5,1,n.emp_files.controls))}}function b(a,d){if(1&a){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",19)(2,"h3",20),t._uU(3," \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA()(),t.TgZ(4,"div",21)(5,"h4"),t._uU(6," \u0627\u0633\u0645 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA()(),t.TgZ(9,"div",21)(10,"h4"),t._uU(11," \u0645\u062f\u0629 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()(),t.TgZ(14,"div",21)(15,"h4"),t._uU(16," \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0627\u0633\u0646\u0627\u062f "),t.qZA(),t.TgZ(17,"p"),t._uU(18),t.ALo(19,"date"),t.qZA()(),t.TgZ(20,"div",22)(21,"h4"),t._uU(22," \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(23,"p"),t._uU(24),t.qZA()(),t.TgZ(25,"div",22),t.YNc(26,M,6,3,"div",23),t.qZA(),t.TgZ(27,"div",22)(28,"h4",24),t._uU(29,"\u0645\u0631\u0641\u0642\u0627\u062a \u0627\u0644\u0634\u0631\u0643\u0629"),t.qZA(),t.TgZ(30,"div",25),t.YNc(31,I,2,1,"div",26),t.ALo(32,"keyvalue"),t.qZA(),t.TgZ(33,"a",27),t.NdJ("click",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.addAttach())}),t._uU(34," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u0641\u0642 "),t.qZA()(),t.YNc(35,U,6,3,"div",23),t.BQk()}if(2&a){const n=t.oxw();t.xp6(8),t.hij(" ",n.activeTask.task_title," "),t.xp6(5),t.hij(" ",n.activeTask.task_period," "),t.xp6(5),t.hij(" ",t.xi3(19,7,n.activeTask.created_at,"yyyy/MM/dd")," "),t.xp6(6),t.hij(" ",n.activeTask.task_description," "),t.xp6(2),t.Q6J("ngIf",n.task_files.controls),t.xp6(5),t.Q6J("ngForOf",t.lcZ(32,10,n.files.controls)),t.xp6(4),t.Q6J("ngIf",n.emp_files.controls)}}function F(a,d){if(1&a&&(t.ynx(0),t._UZ(1,"span",31),t.TgZ(2,"button",32),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.BQk()),2&a){const n=t.oxw();t.xp6(2),t.Q6J("disabled",n.isSaving),t.xp6(1),t.hij(" ",t.lcZ(4,2,"Save")," ")}}let w=(()=>{class a{constructor(n,i,l){this.apiService=n,this.datePipe=i,this.themeService=l,this.FormMode=h.h,this.deleted_attachments=[],this.counter=1,this.tasksObj={},this.isSaving=!1}ngOnInit(){if(this.form=new s.cw({task_id:new s.NI(null,s.kI.required),emp_id:new s.NI(null,s.kI.required),due_date:new s.NI(null,[s.kI.required]),notes:new s.NI(null),attachments:new s.NI(null)}),this.files=new s.cw({}),this.emp_files=new s.cw({}),this.task_files=new s.cw({}),this.data?.company_attachments)for(let i of this.data?.company_attachments)this.files.addControl("attachments_"+i.id,new s.NI({value:i.file_url,disabled:!1}));if(this.data?.emp_attachments)for(let i of this.data?.emp_attachments)this.emp_files.addControl("attachments_"+i.id,new s.NI({value:i.file_url,disabled:!0}));if(this.data?.task?.attachments)for(let i of this.data?.task?.attachments)this.task_files.addControl("attachments_"+i.id,new s.NI({value:i.file_url,disabled:!0}));this.data&&(this.getTasks(this.data.emp_id),this.data.due_date=new Date(this.data.due_date),this.form.patchValue(this.data),this.form.disable(),this.form.controls.due_date.enable()),this.employeeId&&(this.getTasks(this.employeeId),this.form.controls.emp_id.setValue(this.employeeId)),this.mode==h.h.View&&this.form.disable(),console.log(this.employeeId),console.log(this.data)}deleteAttachment(n){this.files.removeControl(n.key),this.deleted_attachments.push(n.key)}addAttach(){this.counter++,this.files.addControl("attachmentss_"+this.counter,new s.NI(null))}add_task_attachments(n){let i={...this.form.value},l=new FormData;for(let u in i)null!==i[u]&&l.append(u,i[u]);l.append("entity_id",n),l.append("entity_type","employee"),l.append("deleted_attachments",this.deleted_attachments);for(let u in this.files.value)null!==this.files.value[u]&&"object"==typeof this.files.value[u]&&l.append(u,this.files.value[u],this.files.value.name)}getTasks(n){this.activeTask=null,this.tasksObj={},null!=n&&this.apiService.get(m.A.misc.emp_tasks+"/"+n).subscribe(i=>{console.log(i),this.tasks=i.tasks||[];let l=!1;for(let u of this.tasks)this.tasksObj[u.id]=u,this.form.controls.task_id.value==u.id&&(l=!0,this.activeTask=u);l||this.form.controls.task_id.setValue(null)})}save(){if(this.form.invalid)return;this.isSaving=!0;let n=this.form.getRawValue();n.due_date=this.datePipe.transform(new Date,"yyyy/MM/dd");let i=new FormData;for(let l in n)null!==n[l]&&i.append(l,n[l]);i.append("entity_id",this.data?.id),i.append("entity_type","employee"),i.append("deleted_attachments",this.deleted_attachments);for(let l in this.files.value)null!==this.files.value[l]&&"object"==typeof this.files.value[l]&&(console.log(this.files.value[l]),i.append(l,this.files.value[l],this.files.value.name));(this.data?this.apiService.uploadFiles(m.A.company.emp_task+"/"+this.data.id,i):this.apiService.post(m.A.company.assign_emp_task,i)).pipe((0,T.x)(()=>this.isSaving=!1)).subscribe(l=>{this.themeService.openSnackBar("SavedSuccessfully",null),this.ref.close(!0),this.table&&this.table.reloadTable()})}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(r.s),t.Y36(e.uU),t.Y36(C.f))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-task-dialog"]],inputs:{ref:"ref",data:"data",employees:"employees",mode:"mode",employeeId:"employeeId",table:"table"},features:[t._Bn([e.uU])],decls:25,vars:14,consts:[[3,"formGroup","ngSubmit"],["mat-dialog-title",""],[1,"mat-typography"],[1,"row"],["class","col-md-4 form-group mb-4",4,"ngIf"],[1,"col-md-4","form-group","mb-4"],["appendTo","body","formControlName","task_id",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-4","mb-3","form-group"],["for","due_date"],[1,"date-input-cont"],["matInput","","formControlName","due_date","id","due_date",3,"matDatepicker"],["matIconSuffix","",3,"for"],["startDatepicker",""],[4,"ngIf"],["align","end",1,"actions"],["type","button","mat-button","","mat-dialog-close","","cdkFocusInitial","",1,"cancel"],["appendTo","body","formControlName","emp_id",3,"change"],[3,"value"],[1,"col-12"],[1,"mt-4"],[1,"col-md-4"],[1,"col-md-12"],["class","col-md-12",4,"ngIf"],[1,"bold","mt-2"],[1,"mb-4","file-item"],["class","mb-4",4,"ngFor","ngForOf"],["mat-button","","color","success",1,"addAttachBtn","mr-2",3,"click"],[1,"bold","mt-5"],[1,"mb-4"],[3,"control","deleteEvent"],[2,"width","32px"],["type","submit","mat-button","","cdkFocusInitial","",1,"save",3,"disabled"]],template:function(n,i){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.save()}),t.TgZ(1,"h2",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-dialog-content",2)(5,"div",3),t.YNc(6,_,5,1,"div",4),t.TgZ(7,"div",5)(8,"label"),t._uU(9," \u0627\u0644\u0645\u0647\u0645\u0629 "),t.qZA(),t.TgZ(10,"ng-select",6),t.NdJ("change",function(u){return i.activeTask=i.tasksObj[u]}),t.YNc(11,p,2,2,"ng-option",7),t.qZA()(),t.TgZ(12,"div",8)(13,"label",9),t._uU(14," \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0633\u062a\u062d\u0642\u0627\u0642 "),t.qZA(),t.TgZ(15,"div",10),t._UZ(16,"input",11)(17,"mat-datepicker-toggle",12)(18,"mat-datepicker",null,13),t.qZA()(),t.YNc(20,b,36,12,"ng-container",14),t.qZA()(),t.TgZ(21,"mat-dialog-actions",15)(22,"button",16),t._uU(23," \u0625\u063a\u0644\u0627\u0642 "),t.qZA(),t.YNc(24,F,5,4,"ng-container",14),t.qZA()()),2&n){const l=t.MAs(19);t.Q6J("formGroup",i.form),t.xp6(2),t.hij(" ",t.lcZ(3,12,i.mode)," \u0627\u0644\u0645\u0647\u0645\u0629 "),t.xp6(4),t.Q6J("ngIf",!i.employeeId),t.xp6(1),t.ekj("col-md-6",i.employeeId),t.xp6(4),t.Q6J("ngForOf",i.tasks),t.xp6(1),t.ekj("col-md-6",i.employeeId),t.xp6(4),t.Q6J("matDatepicker",l),t.xp6(1),t.Q6J("for",l),t.xp6(3),t.Q6J("ngIf",i.activeTask),t.xp6(4),t.Q6J("ngIf",i.mode!==i.FormMode.View)}},dependencies:[e.sg,e.O5,A.Y,O.lW,O.zs,Z.w9,Z.jq,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,v.ZT,v.uh,v.xY,v.H8,D.hL,D.J5,E.Mq,E.hl,E.nW,e.uU,e.Nd,c.X$],styles:[".col-md-4[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]{margin-bottom:1rem}.col-md-4[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:18px;margin-bottom:10px}.col-md-4[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--main-color)}.date-input-cont[_ngcontent-%COMP%]{position:relative}.date-input-cont[_ngcontent-%COMP%]   mat-datepicker-toggle[_ngcontent-%COMP%]{position:absolute;left:8px;top:2px}[_nghost-%COMP%]{min-width:50vw;display:block}h3[_ngcontent-%COMP%]{font-weight:700;color:#0c195f;font-size:17px}textarea[_ngcontent-%COMP%]{min-height:100px}.addAttachBtn[_ngcontent-%COMP%]{background:#dfdfdf;margin-left:10px}.saveAttachBtn[_ngcontent-%COMP%]{background:rgb(90,148,90);color:#fff;margin-left:10px}h4.bold[_ngcontent-%COMP%]{font-weight:700}"]}),a})()},1679:(P,g,o)=>{o.d(g,{Y:()=>E});var e=o(4650),s=o(4763),T=o(6895),h=o(7392),m=o(4859),t=o(4006),r=o(4115),C=o(3416);const A=["control",""];function O(c,f){if(1&c&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&c){const _=e.oxw(2);e.xp6(1),e.hij(" ",_.fileSize," MB ")}}function Z(c,f){if(1&c){const _=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(_);const k=e.oxw(2),M=e.MAs(3);return e.KtG(k.deleteFile(M))}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA()()}}function v(c,f){if(1&c&&(e.TgZ(0,"a",16)(1,"mat-icon"),e._uU(2,"download"),e.qZA()()),2&c){const _=e.oxw(2);e.Q6J("href",_.control.value,e.LSH)}}function D(c,f){if(1&c&&(e.TgZ(0,"div",8)(1,"span",9),e._uU(2),e.qZA(),e.YNc(3,O,2,1,"span",10),e.TgZ(4,"div",11),e.YNc(5,Z,3,0,"button",12),e.YNc(6,v,3,1,"a",13),e.qZA()()),2&c){const _=e.oxw();e.xp6(2),e.hij(" ",(null==_.file?null:_.file.name)||_.fileName," "),e.xp6(1),e.Q6J("ngIf",_.file),e.xp6(2),e.Q6J("ngIf",!_.control.disabled),e.xp6(1),e.Q6J("ngIf",!_.file&&_.control.value)}}let E=(()=>{class c{constructor(){this.accept="image/*",this.deleteEvent=new e.vpe,this.FormMode=s.h}ngOnInit(){this.control.value&&"string"==typeof this.control.value&&(this.fileName=this.control.value.substr(this.control.value.lastIndexOf("/")+1))}fileChanged(_){this.file=_.target.files[0],this.fileSize=(this.file.size/1e6).toFixed(2),this.control.setValue(_.target.files[0]),this.control.markAsTouched()}deleteFile(_){this.file=null,_.type="",_.type="file",this.control.setValue(null),console.log(this.control),this.deleteEvent.emit(this.control)}}return c.\u0275fac=function(_){return new(_||c)},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-file-input","control",""]],inputs:{control:"control",accept:"accept"},outputs:{deleteEvent:"deleteEvent"},attrs:A,decls:11,vars:7,consts:[[1,"data"],[1,"input-cont","form-group"],["id","file","type","file","accept","image/*",3,"change"],["input",""],[1,"d-block"],["for","file"],["type","hidden","name","fileHidden",3,"formControl"],["class","file-info d-flex align-items-center justify-content-between",4,"ngIf"],[1,"file-info","d-flex","align-items-center","justify-content-between"],[1,"file-name"],["class","file-size",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","target","_blank","type","button","download","",3,"href",4,"ngIf"],[1,"file-size"],["mat-button","",3,"click"],["mat-button","","target","_blank","type","button","download","",3,"href"]],template:function(_,p){1&_&&(e.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),e.NdJ("change",function(M){return p.fileChanged(M)}),e.qZA(),e.TgZ(4,"mat-icon",4),e._uU(5," cloud_upload "),e.qZA(),e.TgZ(6,"label",5),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.YNc(10,D,7,4,"div",7),e.qZA()),2&_&&(e.ekj("has-file",!!p.control.value||p.control.disabled),e.xp6(7),e.hij(" ",e.lcZ(8,5,"StartUploadingFile")," "),e.xp6(2),e.Q6J("formControl",p.control),e.xp6(1),e.Q6J("ngIf",p.file||p.control.value||p.control.disabled))},dependencies:[T.O5,h.Hw,m.lW,m.zs,t.Fj,t.JJ,t.oH,r.J5,C.X$],styles:[".invalid-feedback[_ngcontent-%COMP%]{margin-top:-10px}[_nghost-%COMP%]     app-error{position:absolute;left:0;right:-7px;width:140px;bottom:-36px}.file-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;min-width:160px}.file-size[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem;min-width:160px}.file-info[_ngcontent-%COMP%]{flex-wrap:wrap}"]}),c})()},4763:(P,g,o)=>{o.d(g,{h:()=>e});var e=(()=>{return(s=e||(e={})).Create="Create",s.Update="Update",s.View="View",s.Delete="Delete",e;var s})()}}]);